---
title: createStore
description: 创建响应式状态管理 store
---

## 语法

```tsx
const store = createStore(initialState);
```

## 参数

- `initialState`: store 的初始状态对象

## 返回值

一个 ZenBox store 实例，包含以下属性：

- `value`: 只读访问当前状态（启用依赖跟踪）
- `setState(updater, options?)`: 更新 store 状态
- `subscribe(callback, options?)`: 订阅状态变化

## 核心特性

- **完整 TypeScript 支持**: 完整的类型安全和 IntelliSense
- **不可变更新**: 由 Immer 驱动的安全状态变更
- **灵活作用域**: 适用于全局、模块级或组件共享状态
- **响应式跟踪**: 自动依赖检测，实现高效重渲染
- **细粒度订阅**: 订阅特定字段或计算值

## 快速开始

### 基本用法

```tsx
import { createStore, useStoreValue } from "zenbox";

// 创建带有初始状态的 store
const counterStore = createStore({ count: 0 });

// 直接访问状态
console.log("当前计数:", counterStore.value.count);

function Counter() {
  // 订阅响应式更新
  const { count } = useStoreValue(counterStore);

  const increment = () => {
    counterStore.setState((state) => {
      state.count++;
    });
  };

  return (
    <div>
      <p>计数: {count}</p>
      <button onClick={increment}>+</button>
    </div>
  );
}
```

### 带操作的 Store

```tsx
const userStore = createStore({
  // 状态属性
  name: "Del Wang",
  blog: "https://del.wang",
  followers: 0,

  // 操作方法
  follow() {
    userStore.setState((state) => {
      state.followers++;
    });
  },
  async fetchProfile() {
    const response = await fetch("https://api.github.com/users/del-wang");
    const data = await response.json();
    userStore.setState((state) => {
      Object.assign(state, data);
    });
  },
});

// 通过 store.value 调用操作
userStore.value.follow();
console.log("关注者:", userStore.value.followers);
```

## 状态更新方法

### 函数更新（推荐）

使用 Immer 驱动的草稿变更进行安全、高效的更新：

```tsx
store.setState((state) => {
  state.count += 1;
  state.user.name = "更新后";
  state.todos.push({ id: 1, text: "新待办" });
});
```

### 对象更新

部分对象更新会与现有状态合并：

```tsx
const store = createStore({
  name: "张三",
  age: 25,
  email: "zhangsan@example.com",
  avatar: "avatar.jpg",
});

// 部分更新
store.setState({ name: "李四", age: 30 });
// 结果: { name: "李四", age: 30, email: "zhangsan@example.com", avatar: "avatar.jpg" }

// 显式 null 值会覆盖现有属性
store.setState({ avatar: null });
// 结果: { name: "李四", age: 30, email: "zhangsan@example.com", avatar: null }

// 未知属性会被忽略
store.setState({ unknownField: "ignored" }); // 无效果
```

### 直接赋值

简单的值赋值（等同于 `setState`）：

```tsx
const store = createStore({ count: 0, name: "张三" });

// 完整替换
store.value = { count: 1, name: "李四" };

// 部分更新（与现有状态合并）
store.value = { count: 5 };
// 结果: { count: 5, name: "李四" }
```

### 静默更新

更新状态而不触发订阅者通知：

```tsx
// 静默更新不会触发重渲染
store.setState({ cache: data }, { silent: true });
```

## 最佳实践

1. **将操作与状态放在一起** - 直接在初始状态对象中定义方法
2. **使用选择性订阅** - 只订阅你需要的数据
3. **使用函数更新** - 利用 Immer 进行安全变更和更好的性能
4. **批量相关更新** - 在单个 `setState` 调用中组合相关的状态更改
5. **适当使用 `silent: true`** - 对不应触发重渲染的更新使用
6. **选择正确的更新方法**：
   - 使用 `store.value = newState` 进行简单状态替换
   - 使用 `store.setState(updater)` 进行带 Immer 的复杂变更
   - 使用 `store.setState(object)` 进行显式部分更新

## 相关内容

- [`createProvider`](./createProvider) - 创建组件作用域的 store
- [`useStoreValue`](../hooks/useStoreValue) - 订阅 store 变化
- [`usePick`](../hooks/usePick) - 从 store 中选择特定字段
- [`useWatch`](../hooks/useWatch) - 监听计算值和函数